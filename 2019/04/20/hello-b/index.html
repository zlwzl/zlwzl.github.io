<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Single Dog">



<meta name="description" content="第3章-文档型数据库MongoDB学习目标：  理解MongoDb的特点和体系结构  掌握常用的MongoDB命令  能够运用Java操作MongoDB  使用SpringDataMongoDB完成吐槽微服务的开发 ​   1 MongoDB简介1.1 吐槽和评论数据特点分析吐槽和评论两项功能存在以下特点： （1）数据量大 （2）写入操作频繁 （3）价值较低 对于这样的数据，我们更适合使用Mong">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2019/04/20/hello-b/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="第3章-文档型数据库MongoDB学习目标：  理解MongoDb的特点和体系结构  掌握常用的MongoDB命令  能够运用Java操作MongoDB  使用SpringDataMongoDB完成吐槽微服务的开发 ​   1 MongoDB简介1.1 吐槽和评论数据特点分析吐槽和评论两项功能存在以下特点： （1）数据量大 （2）写入操作频繁 （3）价值较低 对于这样的数据，我们更适合使用Mong">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2019/04/20/hello-b/image/3-1.jpg">
<meta property="og:image" content="http://yoursite.com/2019/04/20/hello-b/image/3-2.jpg">
<meta property="og:updated_time" content="2019-03-08T13:04:50.786Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="第3章-文档型数据库MongoDB学习目标：  理解MongoDb的特点和体系结构  掌握常用的MongoDB命令  能够运用Java操作MongoDB  使用SpringDataMongoDB完成吐槽微服务的开发 ​   1 MongoDB简介1.1 吐槽和评论数据特点分析吐槽和评论两项功能存在以下特点： （1）数据量大 （2）写入操作频繁 （3）价值较低 对于这样的数据，我们更适合使用Mong">
<meta name="twitter:image" content="http://yoursite.com/2019/04/20/hello-b/image/3-1.jpg">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Hexo</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: 
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/1.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Single Dog</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Single Dog</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/1.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Single Dog</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我">
</nav>
      <div class="body-wrap"><article id="post-hello-b" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/20/hello-b/" class="article-date">
      <time datetime="2019-04-20T14:58:54.570Z" itemprop="datePublished">2019-04-20</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="第3章-文档型数据库MongoDB"><a href="#第3章-文档型数据库MongoDB" class="headerlink" title="第3章-文档型数据库MongoDB"></a>第3章-文档型数据库MongoDB</h1><p>学习目标：</p>
<ul>
<li><p>理解MongoDb的特点和体系结构</p>
</li>
<li><p>掌握常用的MongoDB命令</p>
</li>
<li><p>能够运用Java操作MongoDB</p>
</li>
<li><p>使用SpringDataMongoDB完成吐槽微服务的开发</p>
<p>​</p>
</li>
</ul>
<h1 id="1-MongoDB简介"><a href="#1-MongoDB简介" class="headerlink" title="1 MongoDB简介"></a>1 MongoDB简介</h1><h2 id="1-1-吐槽和评论数据特点分析"><a href="#1-1-吐槽和评论数据特点分析" class="headerlink" title="1.1 吐槽和评论数据特点分析"></a>1.1 吐槽和评论数据特点分析</h2><p>吐槽和评论两项功能存在以下特点：</p>
<p>（1）数据量大</p>
<p>（2）写入操作频繁</p>
<p>（3）价值较低</p>
<p>对于这样的数据，我们更适合使用MongoDB来实现数据的存储</p>
<p>为什么速度快？存取从内存中，最终会写到磁盘中。</p>
<h2 id="1-2-什么是MongoDB"><a href="#1-2-什么是MongoDB" class="headerlink" title="1.2 什么是MongoDB"></a>1.2 什么是MongoDB</h2><p>​    MongoDB 是一个跨平台的，面向文档的数据库，是当前 NoSQL 数据库产品中最热门<br>的一种。它介于关系数据库和非关系数据库之间，是非关系数据库当中功能最丰富，最像关<br>系数据库的产品。它支持的数据结构非常松散，是类似 JSON 的 BSON 格式，因此可以存<br>储比较复杂的数据类型，没有事务、分布式数据库。<br>​    MongoDB 的官方网站地址是：<a href="http://www.mongodb.org/" target="_blank" rel="noopener">http://www.mongodb.org/</a></p>
<p><img src="image\3-1.jpg" alt>  </p>
<h2 id="1-3-MongoDB特点"><a href="#1-3-MongoDB特点" class="headerlink" title="1.3 MongoDB特点"></a>1.3 MongoDB特点</h2><p>​    MongoDB 最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查<br>询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索<br>引。它是一个面向集合的,模式自由的文档型数据库。<br>具体特点总结如下：<br>（1）面向集合存储，易于存储对象类型的数据<br>（2）模式自由<br>（3）支持动态查询<br>（4）支持完全索引，包含内部对象<br>（5）支持复制和故障恢复<br>（6）使用高效的二进制数据存储，包括大型对象（如视频等）<br>（7）自动处理碎片，以支持云计算层次的扩展性<br>（8）支持 Python，PHP，Ruby，Java，C，C#，Javascript，Perl 及 C++语言的驱动程序，<br>社区中也提供了对 Erlang 及.NET 等平台的驱动程序<br>（9） 文件存储格式为 BSON（一种 JSON 的扩展）</p>
<h2 id="1-4-MongoDB体系结构"><a href="#1-4-MongoDB体系结构" class="headerlink" title="1.4 MongoDB体系结构"></a>1.4 MongoDB体系结构</h2><p>MongoDB 的逻辑结构是一种层次结构。主要由：<br>文档(document)、集合(collection)、数据库(database)这三部分组成的。逻辑结构是面向用户的，用户使用 MongoDB 开发应用程序使用的就是逻辑结构。<br>（1）MongoDB 的文档（document），相当于关系数据库中的一行记录。<br>（2）多个文档组成一个集合（collection），相当于关系数据库的表。<br>（3）多个集合（collection），逻辑上组织在一起，就是数据库（database）。<br>（4）一个 MongoDB 实例支持多个数据库（database）。<br>文档(document)、集合(collection)、数据库(database)的层次结构如下图:</p>
<p><img src="image\3-2.jpg" alt>  </p>
<p>下表是MongoDB与MySQL数据库逻辑结构概念的对比</p>
<table>
<thead>
<tr>
<th>MongoDb</th>
<th>关系型数据库Mysql</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据库(databases)</td>
<td>数据库(databases)</td>
</tr>
<tr>
<td>集合(collections)</td>
<td>表(table)</td>
</tr>
<tr>
<td>文档(document)</td>
<td>行(row)</td>
</tr>
</tbody>
</table>
<h2 id="1-5-数据类型"><a href="#1-5-数据类型" class="headerlink" title="1.5 数据类型"></a>1.5 数据类型</h2><p>基本数据类型</p>
<p>null：用于表示空值或者不存在的字段，{“x”:null}</p>
<p>布尔型：布尔类型有两个值true和false，{“x”:true}</p>
<p>数值：shell默认使用64为浮点型数值。{“x”：3.14}或{“x”：3}。对于整型值，可以使用NumberInt（4字节符号整数）或NumberLong（8字节符号整数），{“x”:NumberInt(“3”)}{“x”:NumberLong(“3”)}</p>
<p>字符串：UTF-8字符串都可以表示为字符串类型的数据，{“x”：“呵呵”}</p>
<p>日期：日期被存储为自新纪元依赖经过的毫秒数，不存储时区，{“x”:new Date()}</p>
<p>正则表达式：查询时，使用正则表达式作为限定条件，语法与JavaScript的正则表达式相同，{“x”:/[abc]/}</p>
<p>数组：数据列表或数据集可以表示为数组，{“x”： [“a“，“b”,”c”]}</p>
<p>内嵌文档：文档可以嵌套其他文档，被嵌套的文档作为值来处理，{“x”:{“y”:3 }}</p>
<p>对象Id：对象id是一个12字节的字符串，是文档的唯一标识，{“x”: objectId() }</p>
<p>二进制数据：二进制数据是一个任意字节的字符串。它不能直接在shell中使用。如果要将非utf-字符保存到数据库中，二进制数据是唯一的方式。</p>
<p>代码：查询和文档中可以包括任何JavaScript代码，{“x”:function(){/<em>…</em>/}}</p>
<h1 id="2-走进MongoDB"><a href="#2-走进MongoDB" class="headerlink" title="2 走进MongoDB"></a>2 走进MongoDB</h1><h2 id="2-1-MongoDB安装与启动"><a href="#2-1-MongoDB安装与启动" class="headerlink" title="2.1 MongoDB安装与启动"></a>2.1 MongoDB安装与启动</h2><h3 id="2-1-1-window系统MongoDB安装"><a href="#2-1-1-window系统MongoDB安装" class="headerlink" title="2.1.1 window系统MongoDB安装"></a>2.1.1 window系统MongoDB安装</h3><p><strong>安装</strong></p>
<p>双击“资源\微服务相关\配套软件\mongodb”中的“mongodb-win32-x86_64-2008plus-ssl-3.2.10-signed.msi” 按照提示步骤安装即可。安装完成后，软件会安装在C:\Program Files\MongoDB 目录中。</p>
<p> 我们要启动的服务程序就是C:\Program Files\MongoDB\Server\3.2\bin目录下的mongod.exe，为了方便我们每次启动，我将C:\Program Files\MongoDB\Server\3.2\bin 设置到<strong>环境变量path</strong>中。</p>
<p><strong>启动</strong></p>
<p>（1）首先打开命令提示符，创建一个用于存放数据的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md d:\data</span><br></pre></td></tr></table></figure>
<p>（2）启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath=d:\data</span><br></pre></td></tr></table></figure>
<p>我们在启动信息中可以看到，mongoDB的默认端口是27017</p>
<p>如果我们想改变默认的启动端口，可以通过–port来指定端口 </p>
<p>在命令提示符输入以下命令即可完成登陆</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure>
<p>退出mongodb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>
<h3 id="1-5-2-Docker-环境下MongoDB安装"><a href="#1-5-2-Docker-环境下MongoDB安装" class="headerlink" title="1.5.2 Docker 环境下MongoDB安装"></a>1.5.2 Docker 环境下MongoDB安装</h3><p>在宿主机创建mongo容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=tensquare_mongo -p 27017:27017 mongo</span><br></pre></td></tr></table></figure>
<p>远程登陆</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo 192.168.184.134</span><br></pre></td></tr></table></figure>
<p>以吐槽表为例讲解MongoDB常用命令</p>
<table>
<thead>
<tr>
<th>吐槽表</th>
<th>spit</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>字段名称</td>
<td>字段含义</td>
<td>字段类型</td>
<td>备注</td>
</tr>
<tr>
<td>_id</td>
<td>ID</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>content</td>
<td>吐槽内容</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>publishtime</td>
<td>发布日期</td>
<td>日期</td>
<td></td>
</tr>
<tr>
<td>userid</td>
<td>发布人ID</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>nickname</td>
<td>发布人昵称</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>visits</td>
<td>浏览量</td>
<td>整型</td>
<td></td>
</tr>
<tr>
<td>thumbup</td>
<td>点赞数</td>
<td>整型</td>
<td></td>
</tr>
<tr>
<td>share</td>
<td>分享数</td>
<td>整型</td>
<td></td>
</tr>
<tr>
<td>comment</td>
<td>回复数</td>
<td>整型</td>
<td></td>
</tr>
<tr>
<td>state</td>
<td>是否可见</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>parentid</td>
<td>上级ID</td>
<td>文本</td>
</tr>
</tbody>
</table>
<h2 id="2-2-常用命令"><a href="#2-2-常用命令" class="headerlink" title="2.2 常用命令"></a>2.2 常用命令</h2><h3 id="2-2-1-选择和创建数据库"><a href="#2-2-1-选择和创建数据库" class="headerlink" title="2.2.1 选择和创建数据库"></a>2.2.1 选择和创建数据库</h3><p>选择和创建数据库的语法格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名称</span><br></pre></td></tr></table></figure>
<p>如果数据库不存在则自动创建</p>
<p>以下语句创建spit数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use spitdb</span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-插入与查询文档"><a href="#2-2-2-插入与查询文档" class="headerlink" title="2.2.2 插入与查询文档"></a>2.2.2 插入与查询文档</h3><p>插入文档的语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.insert(数据);</span><br></pre></td></tr></table></figure>
<p>我们这里可以插入以下测试数据：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.insert(&#123;content:"听说十次方课程很给力呀",userid:"1011",nickname:"小雅",visits:NumberInt(902)&#125;)</span><br></pre></td></tr></table></figure>
<p>查询集合的语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find()</span><br></pre></td></tr></table></figure>
<p>如果我们要查询spit集合的所有文档，我们输入以下命令</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find()</span><br></pre></td></tr></table></figure>
<p>这里你会发现每条文档会有一个叫_id的字段，这个相当于我们原来关系数据库中表的主键，当你在插入文档记录时没有指定该字段，MongoDB会自动创建，其类型是ObjectID类型。如果我们在插入文档记录时指定该字段也可以，其类型可以是ObjectID类型，也可以是MongoDB支持的任意类型。</p>
<p>输入以下测试语句:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.spit.insert(&#123;_id:"1",content:"我还是没有想明白到底为啥出错",userid:"1012",nickname:"小明",visits:NumberInt(2020)&#125;);</span><br><span class="line">db.spit.insert(&#123;_id:"2",content:"加班到半夜",userid:"1013",nickname:"凯撒",visits:NumberInt(1023)&#125;);</span><br><span class="line">db.spit.insert(&#123;_id:"3",content:"手机流量超了咋办？",userid:"1013",nickname:"凯撒",visits:NumberInt(111)&#125;);</span><br><span class="line">db.spit.insert(&#123;_id:"4",content:"坚持就是胜利",userid:"1014",nickname:"诺诺",visits:NumberInt(1223)&#125;);</span><br></pre></td></tr></table></figure>
<p>如果我想按一定条件来查询，比如我想查询userid为1013的记录，怎么办？很简单！只要在find()中添加参数即可，参数也是json格式，如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find(&#123;userid:'1013'&#125;)</span><br></pre></td></tr></table></figure>
<p>如果你只需要返回符合条件的第一条数据，我们可以使用findOne命令来实现</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.findOne(&#123;userid:'1013'&#125;)</span><br></pre></td></tr></table></figure>
<p>如果你想返回指定条数的记录，可以在find方法后调用limit来返回结果，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find().limit(3)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-3-修改与删除文档"><a href="#2-2-3-修改与删除文档" class="headerlink" title="2.2.3 修改与删除文档"></a>2.2.3 修改与删除文档</h3><p>修改文档的语法结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.update(条件,修改后的数据)</span><br></pre></td></tr></table></figure>
<p>如果我们想修改_id为1的记录，浏览量为1000，输入以下语句：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.update(&#123;_id:"1"&#125;,&#123;visits:NumberInt(1000)&#125;)</span><br></pre></td></tr></table></figure>
<p>执行后，我们会发现，这条文档除了visits字段其它字段都不见了，为了解决这个问题，我们需要使用修改器$set来实现，命令如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.update(&#123;_id:"2"&#125;,&#123;$set:&#123;visits:NumberInt(2000)&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>这样就OK啦。</p>
<p>删除文档的语法结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.remove(条件)</span><br></pre></td></tr></table></figure>
<p>以下语句可以将数据全部删除，请<strong>慎用</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.remove(&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>如果删除visits=1000的记录，输入以下语句</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.remove(&#123;visits:1000&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-4-统计条数"><a href="#2-2-4-统计条数" class="headerlink" title="2.2.4 统计条数"></a>2.2.4 统计条数</h3><p>统计记录条件使用count()方法。以下语句统计spit集合的记录数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.count()</span><br></pre></td></tr></table></figure>
<p>如果按条件统计 ，例如：统计userid为1013的记录条数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.count(&#123;userid:"1013"&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-5-模糊查询"><a href="#2-2-5-模糊查询" class="headerlink" title="2.2.5 模糊查询"></a>2.2.5 模糊查询</h3><p>MongoDB的模糊查询是通过正则表达式的方式实现的。格式为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/模糊查询字符串/</span><br></pre></td></tr></table></figure>
<p>例如，我要查询吐槽内容包含“流量”的所有文档，代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find(&#123;content:/流量/&#125;)</span><br></pre></td></tr></table></figure>
<p>如果要查询吐槽内容中以“加班”开头的，代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find(&#123;content:/^加班/&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-6-大于-小于-不等于"><a href="#2-2-6-大于-小于-不等于" class="headerlink" title="2.2.6 大于 小于 不等于"></a>2.2.6 大于 小于 不等于</h3><p>&lt;, &lt;=, &gt;, &gt;= 这个操作符也是很常用的，格式如下:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find(&#123; "field" : &#123; $gt: value &#125;&#125;) // 大于: field &gt; value</span><br><span class="line">db.集合名称.find(&#123; "field" : &#123; $lt: value &#125;&#125;) // 小于: field &lt; value</span><br><span class="line">db.集合名称.find(&#123; "field" : &#123; $gte: value &#125;&#125;) // 大于等于: field &gt;= value</span><br><span class="line">db.集合名称.find(&#123; "field" : &#123; $lte: value &#125;&#125;) // 小于等于: field &lt;= value</span><br><span class="line">db.集合名称.find(&#123; "field" : &#123; $ne: value &#125;&#125;) // 不等于: field != value</span><br></pre></td></tr></table></figure>
<p>示例：查询吐槽浏览量大于1000的记录</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find(&#123;visits:&#123;$gt:1000&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-7-包含与不包含"><a href="#2-2-7-包含与不包含" class="headerlink" title="2.2.7 包含与不包含"></a>2.2.7 包含与不包含</h3><p>包含使用$in操作符。</p>
<p>示例：查询吐槽集合中userid字段包含1013和1014的文档</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find(&#123;userid:&#123;$in:["1013","1014"]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p> 不包含使用$nin操作符。</p>
<p>示例：查询吐槽集合中userid字段不包含1013和1014的文档</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find(&#123;userid:&#123;$nin:["1013","1014"]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-8-条件连接"><a href="#2-2-8-条件连接" class="headerlink" title="2.2.8 条件连接"></a>2.2.8 条件连接</h3><p>我们如果需要查询同时满足两个以上条件，需要使用$and操作符将条件进行关联。（相当于SQL的and）</p>
<p>格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$and:[ &#123;  &#125;,&#123;  &#125;,&#123; &#125; ]</span><br></pre></td></tr></table></figure>
<p>示例：查询吐槽集合中visits大于等于1000 并且小于2000的文档</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find(&#123;$and:[ &#123;visits:&#123;$gte:1000&#125;&#125; ,&#123;visits:&#123;$lt:2000&#125; &#125;]&#125;)</span><br></pre></td></tr></table></figure>
<p>如果两个以上条件之间是或者的关系，我们使用$or操作符进行关联，与前面$and的使用方式相同</p>
<p>格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$or:[ &#123;  &#125;,&#123;  &#125;,&#123;   &#125; ]</span><br></pre></td></tr></table></figure>
<p>示例：查询吐槽集合中userid为1013，或者浏览量小于2000的文档记录</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.find(&#123;$or:[ &#123;userid:"1013"&#125; ,&#123;visits:&#123;$lt:2000&#125; &#125;]&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-9-列值增长"><a href="#2-2-9-列值增长" class="headerlink" title="2.2.9 列值增长"></a>2.2.9 列值增长</h3><p>如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用$inc运算符来实现</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.update(&#123;_id:"2"&#125;,&#123;$inc:&#123;visits:NumberInt(1)&#125;&#125;  )</span><br></pre></td></tr></table></figure>
<h1 id="3-Java操作MongoDB"><a href="#3-Java操作MongoDB" class="headerlink" title="3 Java操作MongoDB"></a>3 Java操作MongoDB</h1><h2 id="3-1-mongodb-driver"><a href="#3-1-mongodb-driver" class="headerlink" title="3.1 mongodb-driver"></a>3.1 mongodb-driver</h2><p>mongodb-driver是mongo官方推出的java连接mongoDB的驱动包，相当于JDBC驱动。我们通过一个入门的案例来了解mongodb-driver的基本使用</p>
<h3 id="3-1-1-查询全部记录"><a href="#3-1-1-查询全部记录" class="headerlink" title="3.1.1 查询全部记录"></a>3.1.1 查询全部记录</h3><p>（1）创建工程 mongoDemo, 引入依赖 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongodb-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）创建测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MongoDb入门小demo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MongoClient client=<span class="keyword">new</span> MongoClient(<span class="string">"192.168.184.134"</span>);<span class="comment">//创建连接</span></span><br><span class="line">        MongoDatabase spitdb = client.getDatabase(<span class="string">"spitdb"</span>);<span class="comment">//打开数据库</span></span><br><span class="line">        MongoCollection&lt;Document&gt; spit = spitdb.getCollection(<span class="string">"spit"</span>);<span class="comment">//获取集合</span></span><br><span class="line">        FindIterable&lt;Document&gt; documents = spit.find();<span class="comment">//查询记录获取文档集合</span></span><br><span class="line">        <span class="keyword">for</span>(Document document:documents)&#123; <span class="comment">//</span></span><br><span class="line">            System.out.println(<span class="string">"内容："</span>+  document.getString(<span class="string">"content"</span>));</span><br><span class="line">            System.out.println(<span class="string">"用户ID:"</span>+document.getString(<span class="string">"userid"</span>));</span><br><span class="line">            System.out.println(<span class="string">"浏览量："</span>+document.getInteger(<span class="string">"visits"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        client.close();<span class="comment">//关闭连接</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-条件查询"><a href="#3-1-2-条件查询" class="headerlink" title="3.1.2 条件查询"></a>3.1.2 条件查询</h3><p>BasicDBObject对象：表示一个具体的记录，BasicDBObject实现了DBObject，是key-value的数据结构，用起来和HashMap是基本一致的。</p>
<p>（1）查询userid为1013的记录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoDemo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        MongoClient client=<span class="keyword">new</span> MongoClient(<span class="string">"192.168.184.134"</span>);<span class="comment">//创建连接</span></span><br><span class="line">        MongoDatabase spitdb = client.getDatabase(<span class="string">"spitdb"</span>);<span class="comment">//打开数据库</span></span><br><span class="line">        MongoCollection&lt;Document&gt; spit = spitdb.getCollection(<span class="string">"spit"</span>);<span class="comment">//获取集合</span></span><br><span class="line">        BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(<span class="string">"userid"</span>,<span class="string">"1013"</span>);<span class="comment">// 构建查询条件</span></span><br><span class="line">        FindIterable&lt;Document&gt; documents = spit.find(bson);<span class="comment">//查询记录获取结果集合</span></span><br><span class="line">        <span class="keyword">for</span>(Document document:documents)&#123; <span class="comment">//</span></span><br><span class="line">            System.out.println(<span class="string">"内容："</span>+  document.getString(<span class="string">"content"</span>));</span><br><span class="line">            System.out.println(<span class="string">"用户ID:"</span>+document.getString(<span class="string">"userid"</span>));</span><br><span class="line">            System.out.println(<span class="string">"浏览量："</span>+document.getInteger(<span class="string">"visits"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        client.close();<span class="comment">//关闭连接</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）查询浏览量大于1000的记录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoDemo2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        MongoClient client=<span class="keyword">new</span> MongoClient(<span class="string">"192.168.184.134"</span>);<span class="comment">//创建连接</span></span><br><span class="line">        MongoDatabase spitdb = client.getDatabase(<span class="string">"spitdb"</span>);<span class="comment">//打开数据库</span></span><br><span class="line">        MongoCollection&lt;Document&gt; spit = spitdb.getCollection(<span class="string">"spit"</span>);<span class="comment">//获取集合</span></span><br><span class="line"></span><br><span class="line">        BasicDBObject bson=<span class="keyword">new</span> BasicDBObject(<span class="string">"visits"</span>,<span class="keyword">new</span> BasicDBObject(<span class="string">"$gt"</span>,<span class="number">1000</span>) );<span class="comment">// 构建查询条件</span></span><br><span class="line">        </span><br><span class="line">        FindIterable&lt;Document&gt; documents = spit.find(bson);<span class="comment">//查询记录获取结果集合</span></span><br><span class="line">        <span class="keyword">for</span>(Document document:documents)&#123; <span class="comment">//</span></span><br><span class="line">            System.out.println(<span class="string">"内容："</span>+  document.getString(<span class="string">"content"</span>));</span><br><span class="line">            System.out.println(<span class="string">"用户ID:"</span>+document.getString(<span class="string">"userid"</span>));</span><br><span class="line">            System.out.println(<span class="string">"浏览量："</span>+document.getInteger(<span class="string">"visits"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        client.close();<span class="comment">//关闭连接</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-插入数据"><a href="#3-1-3-插入数据" class="headerlink" title="3.1.3 插入数据"></a>3.1.3 插入数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoDemo3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MongoClient client=<span class="keyword">new</span> MongoClient(<span class="string">"192.168.184.134"</span>);<span class="comment">//创建连接</span></span><br><span class="line">        MongoDatabase spitdb = client.getDatabase(<span class="string">"spitdb"</span>);<span class="comment">//打开数据库</span></span><br><span class="line">        MongoCollection&lt;Document&gt; spit = spitdb.getCollection(<span class="string">"spit"</span>);<span class="comment">//获取集合</span></span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map=<span class="keyword">new</span> HashMap();</span><br><span class="line">        map.put(<span class="string">"content"</span>,<span class="string">"我要吐槽"</span>);</span><br><span class="line">        map.put(<span class="string">"userid"</span>,<span class="string">"9999"</span>);</span><br><span class="line">        map.put(<span class="string">"visits"</span>,<span class="number">123</span>);</span><br><span class="line">        map.put(<span class="string">"publishtime"</span>,<span class="keyword">new</span> Date());</span><br><span class="line">        Document document=<span class="keyword">new</span> Document(map);</span><br><span class="line"></span><br><span class="line">        spit.insertOne(document);<span class="comment">//插入数据</span></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-2-SpringDataMongoDB"><a href="#3-2-SpringDataMongoDB" class="headerlink" title="3.2 SpringDataMongoDB"></a>3.2 SpringDataMongoDB</h2><p>SpringData家族成员之一，用于操作MongoDb的持久层框架，封装了底层的mongodb-driver。</p>
<p>官网主页： <a href="https://projects.spring.io/spring-data-mongodb/" target="_blank" rel="noopener">https://projects.spring.io/spring-data-mongodb/</a></p>
<p>我们十次方项目的吐槽微服务就采用SpringDataMongoDB框架</p>
<h1 id="4-吐槽微服务"><a href="#4-吐槽微服务" class="headerlink" title="4 吐槽微服务"></a>4 吐槽微服务</h1><h2 id="4-1-需求分析"><a href="#4-1-需求分析" class="headerlink" title="4.1 需求分析"></a>4.1 需求分析</h2><p>采用SpringDataMongoDB框架实现吐槽微服务的持久层。</p>
<p>实现功能：</p>
<p>（1）基本增删改查API</p>
<p>（2）根据上级ID查询吐槽列表</p>
<p>（3）吐槽点赞</p>
<p>（4）发布吐槽</p>
<h2 id="4-2-代码编写"><a href="#4-2-代码编写" class="headerlink" title="4.2 代码编写"></a>4.2 代码编写</h2><h3 id="4-2-1-模块搭建"><a href="#4-2-1-模块搭建" class="headerlink" title="4.2.1 模块搭建"></a>4.2.1 模块搭建</h3><p>（1）搭建子模块 tensquare_spit  </p>
<p>（2）pom.xml引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>		</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tensquare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tensquare_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）创建application.yml </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line"><span class="attr">  port:</span> <span class="number">9006</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line"><span class="attr">  application:</span>  </span><br><span class="line"><span class="attr">    name:</span> <span class="string">tensquare-spit</span> <span class="comment">#指定服务名</span></span><br><span class="line"><span class="attr">  data:</span></span><br><span class="line"><span class="attr">    mongodb:</span></span><br><span class="line"><span class="attr">      host:</span> <span class="number">192.168</span><span class="number">.184</span><span class="number">.134</span></span><br><span class="line"><span class="attr">      database:</span> <span class="string">spitdb</span></span><br></pre></td></tr></table></figure>
<p>（4）创建启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(SpitApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IdWorker <span class="title">idWorkker</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> IdWorker(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2基本增删改查API实现"><a href="#4-2-2基本增删改查API实现" class="headerlink" title="4.2.2基本增删改查API实现"></a>4.2.2基本增删改查API实现</h3><p>（1）创建实体类</p>
<p>创建包com.tensquare.spit，包下建包pojo 用于存放实体类，创建实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 吐槽</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spit</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String _id;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> Date publishtime;</span><br><span class="line">    <span class="keyword">private</span> String userid;</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> Integer visits;</span><br><span class="line">    <span class="keyword">private</span> Integer thumbup;</span><br><span class="line">    <span class="keyword">private</span> Integer share;</span><br><span class="line">    <span class="keyword">private</span> Integer comment;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    <span class="keyword">private</span> String parentid;</span><br><span class="line">	<span class="comment">// getter and setter .....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）创建数据访问接口</p>
<p>com.tensquare.spit包下创建dao包，包下创建接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 吐槽数据访问层</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitDao</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Spit</span>, <span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）创建业务逻辑类</p>
<p>com.tensquare.spit包下创建service包，包下创建类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SpitDao spitDao;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> IdWorker idWorker;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询全部记录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Spit&gt; <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> spitDao.findAll();		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据主键查询实体</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Spit <span class="title">findById</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">		Spit spit = spitDao.findById(id).get();</span><br><span class="line">		<span class="keyword">return</span> spit;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 增加</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> spit</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Spit spit)</span> </span>&#123;</span><br><span class="line">		spit.set_id(idWorker.nextId()+<span class="string">""</span>); <span class="comment">//主键值</span></span><br><span class="line">		spitDao.save(spit);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 修改</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> spit</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Spit spit)</span> </span>&#123;</span><br><span class="line">		spitDao.save(spit);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">		spitDao.deleteById(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）com.tensquare.spit包下创建controller类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/spit"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpitService spitService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询全部数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method= RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, StatusCode.OK,<span class="string">"查询成功"</span>,spitService.findAll());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ID查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;id&#125;"</span>,method=RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">findOne</span><span class="params">(@PathVariable String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>,StatusCode.OK,<span class="string">"查询成功"</span>,spitService.findById(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spit</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method=RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">add</span><span class="params">(@RequestBody Spit spit  )</span></span>&#123;</span><br><span class="line">        spitService.add(spit);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>,StatusCode.OK,<span class="string">"增加成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spit</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;id&#125;"</span>,method=RequestMethod.PUT)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">update</span><span class="params">(@RequestBody Spit spit,@PathVariable String id )</span></span>&#123;</span><br><span class="line">        spit.set_id(id);</span><br><span class="line">        spitService.update(spit);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>,StatusCode.OK,<span class="string">"修改成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;id&#125;"</span>,method=RequestMethod.DELETE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">deleteById</span><span class="params">(@PathVariable String id )</span></span>&#123;</span><br><span class="line">        spitService.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>,StatusCode.OK,<span class="string">"删除成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-3-根据上级ID查询吐槽列表"><a href="#4-2-3-根据上级ID查询吐槽列表" class="headerlink" title="4.2.3 根据上级ID查询吐槽列表"></a>4.2.3 根据上级ID查询吐槽列表</h3><p>（1）SpitDao新增方法定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据上级ID查询吐槽列表（分页）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parentid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Spit&gt; <span class="title">findByParentid</span><span class="params">(String parentid,Pageable pageable)</span></span>;</span><br></pre></td></tr></table></figure>
<p>（2）SpitService新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据上级ID查询吐槽列表</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> parentid</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Page&lt;Spit&gt; <span class="title">findByParentid</span><span class="params">(String parentid,<span class="keyword">int</span> page, <span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">      PageRequest pageRequest = PageRequest.of(page-<span class="number">1</span>, size);</span><br><span class="line">      <span class="keyword">return</span> spitDao.findByParentid(parentid, pageRequest);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>（3）SpitController新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据上级ID查询吐槽分页数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/comment/&#123;parentId&#125;/&#123;page&#125;/&#123;size&#125;"</span>,method=RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findByParentid</span><span class="params">(@PathVariable String parentId,  @PathVariable <span class="keyword">int</span> page,@PathVariable <span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">    Page&lt;Spit&gt; pageList = spitService.findByParentid(parentId,page, size);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>,StatusCode.OK,<span class="string">"查询成功"</span>,<span class="keyword">new</span> PageResult&lt;Spit&gt;(pageList.getTotalElements(), pageList.getContent() ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-吐槽点赞"><a href="#4-2-4-吐槽点赞" class="headerlink" title="4.2.4 吐槽点赞"></a>4.2.4 吐槽点赞</h3><p>我们看一下以下点赞的代码：  SpitService 新增updateThumbup方法  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点赞</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateThumbup</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">    Spit spit = spitDao.findById(id).get();</span><br><span class="line">    spit.setThumbup(spit.getThumbup()+<span class="number">1</span>);</span><br><span class="line">    spitDao.save(spit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上方法虽然实现起来比较简单，但是执行效率并不高，因为我只需要将点赞数加1就可以了，没必要查询出所有字段修改后再更新所有字段。</p>
<p>我们可以使用MongoTemplate类来实现对某列的操作。 </p>
<p>（1）修改SpitService </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点赞</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateThumbup</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">    Query query=<span class="keyword">new</span> Query();</span><br><span class="line">    query.addCriteria(Criteria.where(<span class="string">"_id"</span>).is(id));</span><br><span class="line">    Update update=<span class="keyword">new</span> Update();</span><br><span class="line">    update.inc(<span class="string">"thumbup"</span>,<span class="number">1</span>);</span><br><span class="line">    mongoTemplate.updateFirst(query,update,<span class="string">"spit"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）SpitController新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点赞</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/thumbup/&#123;id&#125;"</span>,method=RequestMethod.PUT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">updateThumbup</span><span class="params">(@PathVariable String id)</span></span>&#123;      </span><br><span class="line">    spitService.updateThumbup(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>,StatusCode.OK,<span class="string">"点赞成功"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-5-控制不能重复点赞"><a href="#4-2-5-控制不能重复点赞" class="headerlink" title="4.2.5 控制不能重复点赞"></a>4.2.5 控制不能重复点赞</h3><p>我们可以通过redis控制用户不能重复点赞 </p>
<p>（1）首先引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）修改application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">redis:</span></span><br><span class="line"><span class="attr">  host:</span> <span class="number">192.168</span><span class="number">.184</span><span class="number">.135</span></span><br></pre></td></tr></table></figure>
<p>（3）修改SpitController代码逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 吐槽点赞</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/thumbup/&#123;id&#125;"</span>, method = RequestMethod.PUT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">updateThumbup</span><span class="params">(@PathVariable String id)</span></span>&#123;</span><br><span class="line">    <span class="comment">//判断用户是否点过赞</span></span><br><span class="line">    String userid=<span class="string">"2023"</span>;<span class="comment">// 后边我们会修改为当前登陆的用户</span></span><br><span class="line">    <span class="keyword">if</span>(redisTemplate.opsForValue().get(<span class="string">"thumbup_"</span>+userid+<span class="string">"_"</span>+ id)!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>,StatusCode.REPERROR,<span class="string">"你已经点过赞了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    spitService.updateThumbup(id);</span><br><span class="line">    redisTemplate.opsForValue().set( <span class="string">"thumbup_"</span>+userid+<span class="string">"_"</span>+ id,<span class="string">"1"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>,StatusCode.OK,<span class="string">"点赞成功"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-6-发布吐槽"><a href="#4-2-6-发布吐槽" class="headerlink" title="4.2.6 发布吐槽"></a>4.2.6 发布吐槽</h3><p>修改SpitService的add方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 发布吐槽（或吐槽评论）</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> spit</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Spit spit)</span></span>&#123;</span><br><span class="line">     spit.set_id( idWorker.nextId()+<span class="string">""</span> );</span><br><span class="line">     spit.setPublishtime(<span class="keyword">new</span> Date());<span class="comment">//发布日期</span></span><br><span class="line">     spit.setVisits(<span class="number">0</span>);<span class="comment">//浏览量</span></span><br><span class="line">     spit.setShare(<span class="number">0</span>);<span class="comment">//分享数</span></span><br><span class="line">     spit.setThumbup(<span class="number">0</span>);<span class="comment">//点赞数</span></span><br><span class="line">     spit.setComment(<span class="number">0</span>);<span class="comment">//回复数</span></span><br><span class="line">     spit.setState(<span class="string">"1"</span>);<span class="comment">//状态</span></span><br><span class="line">     <span class="keyword">if</span>(spit.getParentid()!=<span class="keyword">null</span> &amp;&amp; !<span class="string">""</span>.equals(spit.getParentid()))&#123;<span class="comment">//如果存在上级ID,评论</span></span><br><span class="line">         Query query=<span class="keyword">new</span> Query();</span><br><span class="line">         query.addCriteria(Criteria.where(<span class="string">"_id"</span>).is(spit.getParentid()));</span><br><span class="line">         Update update=<span class="keyword">new</span> Update();</span><br><span class="line">         update.inc(<span class="string">"comment"</span>,<span class="number">1</span>);</span><br><span class="line">         mongoTemplate.updateFirst(query,update,<span class="string">"spit"</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     spitDao.save(spit);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-7-增加浏览量与分享数"><a href="#4-2-7-增加浏览量与分享数" class="headerlink" title="4.2.7 增加浏览量与分享数"></a>4.2.7 增加浏览量与分享数</h3><p>学员实现</p>
<h1 id="5-文章评论功能开发"><a href="#5-文章评论功能开发" class="headerlink" title="5 文章评论功能开发"></a>5 文章评论功能开发</h1><h2 id="5-1-表结构分析"><a href="#5-1-表结构分析" class="headerlink" title="5.1 表结构分析"></a>5.1 表结构分析</h2><p>集合结构：</p>
<table>
<thead>
<tr>
<th>专栏文章评论</th>
<th>comment</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>字段名称</td>
<td>字段含义</td>
<td>字段类型</td>
<td>备注</td>
</tr>
<tr>
<td>_id</td>
<td>ID</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>articleid</td>
<td>文章ID</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>content</td>
<td>评论内容</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>userid</td>
<td>评论人ID</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>parentid</td>
<td>评论ID</td>
<td>文本</td>
<td>如果为0表示文章的顶级评论</td>
</tr>
<tr>
<td>publishdate</td>
<td>评论日期</td>
<td>日期</td>
</tr>
</tbody>
</table>
<h2 id="5-2-代码编写"><a href="#5-2-代码编写" class="headerlink" title="5.2 代码编写"></a>5.2 代码编写</h2><p>以下功能学员实现</p>
<h3 id="4-2-1-新增评论"><a href="#4-2-1-新增评论" class="headerlink" title="4.2.1 新增评论"></a>4.2.1 新增评论</h3><p>（1）修改tensquare_article工程的pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）修改application.yml ,在spring节点下新增配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data:</span></span><br><span class="line"><span class="attr">  mongodb:</span></span><br><span class="line"><span class="attr">    host:</span> <span class="number">192.168</span><span class="number">.184</span><span class="number">.134</span></span><br><span class="line"><span class="attr">    database:</span> <span class="string">recruitdb</span></span><br></pre></td></tr></table></figure>
<p>（3）创建实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章评论（mongoDB）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="keyword">private</span> String _id;</span><br><span class="line">	<span class="keyword">private</span> String articleid;</span><br><span class="line">	<span class="keyword">private</span> String content;</span><br><span class="line">	<span class="keyword">private</span> String userid;</span><br><span class="line">	<span class="keyword">private</span> String parentid;</span><br><span class="line">	<span class="keyword">private</span> Date publishdate;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//getter and setter....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）创建数据访问接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论Dao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommentDao</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Comment</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（5）创建业务逻辑类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> CommentDao commentDao;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> IdWorker idWorker;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Comment comment)</span></span>&#123;</span><br><span class="line">		comment.setId( idWorker.nextId()+<span class="string">""</span>  );</span><br><span class="line">		commentDao.save(comment);		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（6）创建控制器类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/comment"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> CommentService commentService;</span><br><span class="line">		</span><br><span class="line">	<span class="meta">@RequestMapping</span>(method= RequestMethod.POST)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">save</span><span class="params">(@RequestBody Comment comment)</span></span>&#123;</span><br><span class="line">		commentService.add(comment);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, StatusCode.OK, <span class="string">"提交成功 "</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-根据文章ID查询评论列表"><a href="#4-2-2-根据文章ID查询评论列表" class="headerlink" title="4.2.2 根据文章ID查询评论列表"></a>4.2.2 根据文章ID查询评论列表</h3><p>（1）CommentDao新增方法定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据文章ID查询评论列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> articleid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Comment&gt; <span class="title">findByArticleid</span><span class="params">(String articleid)</span></span>;</span><br></pre></td></tr></table></figure>
<p>（2）CommentService新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Comment&gt; <span class="title">findByArticleid</span><span class="params">(String articleid)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> commentDao.findByArticleid(articleid);		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）CommentController新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/article/&#123;articleid&#125;"</span>,method= RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findByArticleid</span><span class="params">(@PathVariable String articleid)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, StatusCode.OK, <span class="string">"查询成功"</span>,  commentService.findByArticleid(articleid));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-3-删除评论"><a href="#4-2-3-删除评论" class="headerlink" title="4.2.3 删除评论"></a>4.2.3 删除评论</h3><p>代码略</p>
<h1 id="面试问题总结"><a href="#面试问题总结" class="headerlink" title="面试问题总结"></a>面试问题总结</h1><h2 id="你在项目中有没有使用到mongodb"><a href="#你在项目中有没有使用到mongodb" class="headerlink" title="你在项目中有没有使用到mongodb?"></a>你在项目中有没有使用到mongodb?</h2><h2 id="你的工程是如何操作MongoDB的？"><a href="#你的工程是如何操作MongoDB的？" class="headerlink" title="你的工程是如何操作MongoDB的？"></a>你的工程是如何操作MongoDB的？</h2><p>spring data mongodb</p>
<h2 id="在项目的哪些场景下使用MongoDB"><a href="#在项目的哪些场景下使用MongoDB" class="headerlink" title="在项目的哪些场景下使用MongoDB ?"></a>在项目的哪些场景下使用MongoDB ?</h2><p>吐槽 、文章评论、日志</p>
<h2 id="为什么在吐槽和文章评论中使用Mongodb而不使用mysql"><a href="#为什么在吐槽和文章评论中使用Mongodb而不使用mysql" class="headerlink" title="为什么在吐槽和文章评论中使用Mongodb而不使用mysql?"></a>为什么在吐槽和文章评论中使用Mongodb而不使用mysql?</h2><p>吐槽和评论都是数据量较大且价值较低的数据，为了减轻mysql的压力，我们使用mongodb</p>
<h2 id="MongoDB优点缺点？不支持事务。"><a href="#MongoDB优点缺点？不支持事务。" class="headerlink" title="MongoDB优点缺点？不支持事务。"></a>MongoDB优点缺点？不支持事务。</h2>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2019/04/20/hello-b/"></a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Single Dog</a></p>
        <p><span>发布时间:</span>2019-04-20, 22:58:54</p>
        <p><span>最后更新:</span>2019-03-08, 21:04:50</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2019/04/20/hello-b/" title>http://yoursite.com/2019/04/20/hello-b/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2019/04/20/hello-b/　　作者: Single Dog" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2019/04/20/my-work0 (4)/">
                    
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2019/04/20/hello-a/">
                    
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#第3章-文档型数据库MongoDB"><span class="toc-number">1.</span> <span class="toc-text">第3章-文档型数据库MongoDB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-MongoDB简介"><span class="toc-number">2.</span> <span class="toc-text">1 MongoDB简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-吐槽和评论数据特点分析"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 吐槽和评论数据特点分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-什么是MongoDB"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 什么是MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-MongoDB特点"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 MongoDB特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-MongoDB体系结构"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 MongoDB体系结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-数据类型"><span class="toc-number">2.5.</span> <span class="toc-text">1.5 数据类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-走进MongoDB"><span class="toc-number">3.</span> <span class="toc-text">2 走进MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-MongoDB安装与启动"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 MongoDB安装与启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-window系统MongoDB安装"><span class="toc-number">3.1.1.</span> <span class="toc-text">2.1.1 window系统MongoDB安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2-Docker-环境下MongoDB安装"><span class="toc-number">3.1.2.</span> <span class="toc-text">1.5.2 Docker 环境下MongoDB安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-常用命令"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-选择和创建数据库"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.2.1 选择和创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-插入与查询文档"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2.2 插入与查询文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-修改与删除文档"><span class="toc-number">3.2.3.</span> <span class="toc-text">2.2.3 修改与删除文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-统计条数"><span class="toc-number">3.2.4.</span> <span class="toc-text">2.2.4 统计条数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-5-模糊查询"><span class="toc-number">3.2.5.</span> <span class="toc-text">2.2.5 模糊查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-6-大于-小于-不等于"><span class="toc-number">3.2.6.</span> <span class="toc-text">2.2.6 大于 小于 不等于</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-7-包含与不包含"><span class="toc-number">3.2.7.</span> <span class="toc-text">2.2.7 包含与不包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-8-条件连接"><span class="toc-number">3.2.8.</span> <span class="toc-text">2.2.8 条件连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-9-列值增长"><span class="toc-number">3.2.9.</span> <span class="toc-text">2.2.9 列值增长</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Java操作MongoDB"><span class="toc-number">4.</span> <span class="toc-text">3 Java操作MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-mongodb-driver"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 mongodb-driver</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-查询全部记录"><span class="toc-number">4.1.1.</span> <span class="toc-text">3.1.1 查询全部记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-条件查询"><span class="toc-number">4.1.2.</span> <span class="toc-text">3.1.2 条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-插入数据"><span class="toc-number">4.1.3.</span> <span class="toc-text">3.1.3 插入数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-SpringDataMongoDB"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 SpringDataMongoDB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-吐槽微服务"><span class="toc-number">5.</span> <span class="toc-text">4 吐槽微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-需求分析"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 需求分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-代码编写"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 代码编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-模块搭建"><span class="toc-number">5.2.1.</span> <span class="toc-text">4.2.1 模块搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2基本增删改查API实现"><span class="toc-number">5.2.2.</span> <span class="toc-text">4.2.2基本增删改查API实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-根据上级ID查询吐槽列表"><span class="toc-number">5.2.3.</span> <span class="toc-text">4.2.3 根据上级ID查询吐槽列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-吐槽点赞"><span class="toc-number">5.2.4.</span> <span class="toc-text">4.2.4 吐槽点赞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-控制不能重复点赞"><span class="toc-number">5.2.5.</span> <span class="toc-text">4.2.5 控制不能重复点赞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-6-发布吐槽"><span class="toc-number">5.2.6.</span> <span class="toc-text">4.2.6 发布吐槽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-7-增加浏览量与分享数"><span class="toc-number">5.2.7.</span> <span class="toc-text">4.2.7 增加浏览量与分享数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-文章评论功能开发"><span class="toc-number">6.</span> <span class="toc-text">5 文章评论功能开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-表结构分析"><span class="toc-number">6.1.</span> <span class="toc-text">5.1 表结构分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-代码编写"><span class="toc-number">6.2.</span> <span class="toc-text">5.2 代码编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-新增评论"><span class="toc-number">6.2.1.</span> <span class="toc-text">4.2.1 新增评论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-根据文章ID查询评论列表"><span class="toc-number">6.2.2.</span> <span class="toc-text">4.2.2 根据文章ID查询评论列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-删除评论"><span class="toc-number">6.2.3.</span> <span class="toc-text">4.2.3 删除评论</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#面试问题总结"><span class="toc-number">7.</span> <span class="toc-text">面试问题总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#你在项目中有没有使用到mongodb"><span class="toc-number">7.1.</span> <span class="toc-text">你在项目中有没有使用到mongodb?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#你的工程是如何操作MongoDB的？"><span class="toc-number">7.2.</span> <span class="toc-text">你的工程是如何操作MongoDB的？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在项目的哪些场景下使用MongoDB"><span class="toc-number">7.3.</span> <span class="toc-text">在项目的哪些场景下使用MongoDB ?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么在吐槽和文章评论中使用Mongodb而不使用mysql"><span class="toc-number">7.4.</span> <span class="toc-text">为什么在吐槽和文章评论中使用Mongodb而不使用mysql?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB优点缺点？不支持事务。"><span class="toc-number">7.5.</span> <span class="toc-text">MongoDB优点缺点？不支持事务。</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"　| Hexo　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2019/04/20/my-work0 (4)/" title="上一篇: ">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2019/04/20/hello-a/" title="下一篇: ">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (10)/">my-work0 (10)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (9)/">my-work0 (9)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (8)/">my-work0 (8)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (7)/">my-work0 (7)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (6)/">my-work0 (6)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (5)/">my-work0 (5)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (4)/">my-work0 (4)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/hello-b/">hello-b</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/hello-a/">hello-a</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2019 Single Dog
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>