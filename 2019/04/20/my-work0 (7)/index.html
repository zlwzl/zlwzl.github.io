<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Single Dog">



<meta name="description" content="第7章-SpringCloud之初入江湖学习目标：  能够说出SpringCloud包含的主要框架 能够使用服务发现组件Eureka 能够使用Feign实现服务间的调用 完成交友微服务开发  1 SpringCloud简介1.1 什么是SpringCloud​    Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2019/04/20/my-work0 (7)/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="第7章-SpringCloud之初入江湖学习目标：  能够说出SpringCloud包含的主要框架 能够使用服务发现组件Eureka 能够使用Feign实现服务间的调用 完成交友微服务开发  1 SpringCloud简介1.1 什么是SpringCloud​    Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2019/04/20/my-work0%20(7)/image/6-1.jpg">
<meta property="og:image" content="http://yoursite.com/2019/04/20/my-work0%20(7)/image/7_2.png">
<meta property="og:image" content="http://yoursite.com/2019/04/20/my-work0%20(7)/image/7_1.png">
<meta property="og:updated_time" content="2019-03-08T13:12:36.588Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="第7章-SpringCloud之初入江湖学习目标：  能够说出SpringCloud包含的主要框架 能够使用服务发现组件Eureka 能够使用Feign实现服务间的调用 完成交友微服务开发  1 SpringCloud简介1.1 什么是SpringCloud​    Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务">
<meta name="twitter:image" content="http://yoursite.com/2019/04/20/my-work0%20(7)/image/6-1.jpg">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Hexo</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: 
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/1.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Single Dog</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Single Dog</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/1.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Single Dog</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我">
</nav>
      <div class="body-wrap"><article id="post-my-work0 (7)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/20/my-work0 (7)/" class="article-date">
      <time datetime="2019-04-20T14:58:54.621Z" itemprop="datePublished">2019-04-20</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="第7章-SpringCloud之初入江湖"><a href="#第7章-SpringCloud之初入江湖" class="headerlink" title="第7章-SpringCloud之初入江湖"></a>第7章-SpringCloud之初入江湖</h1><p>学习目标：</p>
<ul>
<li>能够说出SpringCloud包含的主要框架</li>
<li>能够使用服务发现组件Eureka</li>
<li>能够使用Feign实现服务间的调用</li>
<li>完成交友微服务开发</li>
</ul>
<h1 id="1-SpringCloud简介"><a href="#1-SpringCloud简介" class="headerlink" title="1 SpringCloud简介"></a>1 SpringCloud简介</h1><h2 id="1-1-什么是SpringCloud"><a href="#1-1-什么是SpringCloud" class="headerlink" title="1.1 什么是SpringCloud"></a>1.1 什么是SpringCloud</h2><p>​    Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、熔断器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。Spring并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来，通过Spring Boot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。</p>
<p>​    Spring Cloud项目的官方网址：<a href="http://projects.spring.io/spring-cloud/" target="_blank" rel="noopener">http://projects.spring.io/spring-cloud/</a></p>
<h2 id="1-2-SpringCloud与SpringBoot的关系"><a href="#1-2-SpringCloud与SpringBoot的关系" class="headerlink" title="1.2 SpringCloud与SpringBoot的关系"></a>1.2 SpringCloud与SpringBoot的关系</h2><p>​    Spring Boot 是 Spring 的一套快速配置脚手架，可以基于Spring Boot 快速开发单个微服务，Spring Cloud是一个基于Spring Boot实现的云应用开发工具；Spring Boot专注于快速、方便集成的单个微服务个体，Spring Cloud关注全局的服务治理框架；Spring Boot使用了默认大于配置的理念，很多集成方案已经帮你选择好了，能不配置就不配置，Spring Cloud很大的一部分是基于Spring Boot来实现，可以不基于Spring Boot吗？不可以。</p>
<p>​    Spring Boot可以离开Spring Cloud独立使用开发项目，但是Spring Cloud离不开Spring Boot，属于依赖的关系。</p>
<h2 id="1-3-SpringCloud主要框架"><a href="#1-3-SpringCloud主要框架" class="headerlink" title="1.3 SpringCloud主要框架"></a>1.3 SpringCloud主要框架</h2><ul>
<li>服务发现——Netflix Eureka</li>
<li>服务调用——Netflix Feign</li>
<li>熔断器——Netflix Hystrix</li>
<li>服务网关——Netflix Zuul</li>
<li>分布式配置——Spring Cloud Config</li>
<li>消息总线   —— Spring Cloud Bus</li>
</ul>
<h2 id="1-4-Spring-Cloud和Dubbo对比"><a href="#1-4-Spring-Cloud和Dubbo对比" class="headerlink" title="1.4 Spring Cloud和Dubbo对比"></a>1.4 Spring Cloud和Dubbo对比</h2><p>​      或许很多人会说Spring Cloud和Dubbo的对比有点不公平，Dubbo只是实现了服务治理，而Spring Cloud下面有17个子项目（可能还会新增）分别覆盖了微服务架构下的方方面面，服务治理只是其中的一个方面，一定程度来说，Dubbo只是Spring Cloud Netflix中的一个子集。</p>
<table>
<thead>
<tr>
<th></th>
<th>Dubbo</th>
<th>Spring Cloud</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务注册中心</td>
<td>Zookeeper</td>
<td>Spring Cloud Netflix Eureka</td>
</tr>
<tr>
<td>服务调用方式</td>
<td>RPC</td>
<td>REST API</td>
</tr>
<tr>
<td>服务网关</td>
<td>无</td>
<td>Spring Cloud Netflix Zuul</td>
</tr>
<tr>
<td>熔断器</td>
<td>不完善</td>
<td>Spring Cloud Netflix Hystrix</td>
</tr>
<tr>
<td>分布式配置</td>
<td>无</td>
<td>Spring Cloud Config</td>
</tr>
<tr>
<td>服务跟踪</td>
<td>无</td>
<td>Spring Cloud Sleuth</td>
</tr>
<tr>
<td>消息总线</td>
<td>无</td>
<td>Spring Cloud Bus</td>
</tr>
<tr>
<td>数据流</td>
<td>无</td>
<td>Spring Cloud Stream</td>
</tr>
<tr>
<td>批量任务</td>
<td>无</td>
<td>Spring Cloud Task</td>
</tr>
<tr>
<td>……</td>
<td>……</td>
<td>……</td>
</tr>
</tbody>
</table>
<h2 id="1-5-说说SpringCloud的版本"><a href="#1-5-说说SpringCloud的版本" class="headerlink" title="1.5 说说SpringCloud的版本"></a>1.5 说说SpringCloud的版本</h2><p>我们目前课程采用的SpringCloud版本为Finchley.M9  。你可能会觉得这个版本怎么这么奇怪？SpringCloud由于是一系列框架组合，为了避免与包含的自框架版本产生混淆，采用伦敦地铁站的名称作为版本名，形式为版本名+里程碑号。  M9为第9个里程碑版本。</p>
<p>以下是SpringBoot与Spring Cloud版本的对照表，大家看看有没有找到什么规律呢？</p>
<table>
<thead>
<tr>
<th>Spring Boot</th>
<th>Spring Cloud</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.2.x</td>
<td>Angel版本</td>
</tr>
<tr>
<td>1.3.x</td>
<td>Brixton版本</td>
</tr>
<tr>
<td>1.4.x</td>
<td>Camden版本</td>
</tr>
<tr>
<td>1.5.x</td>
<td>Dalston版本、Edgware版本</td>
</tr>
<tr>
<td>2.0.x</td>
<td>Finchley版本</td>
</tr>
</tbody>
</table>
<h1 id="2-服务发现组件-Eureka"><a href="#2-服务发现组件-Eureka" class="headerlink" title="2 服务发现组件 Eureka"></a>2 服务发现组件 Eureka</h1><h2 id="2-1-Eureka"><a href="#2-1-Eureka" class="headerlink" title="2.1 Eureka"></a>2.1 Eureka</h2><p>​    Eureka是Netflix开发的服务发现框架，SpringCloud将它集成在自己的子项目spring-cloud-netflix中，实现SpringCloud的服务发现功能。Eureka包含两个组件：Eureka Server和Eureka Client。</p>
<p>​    Eureka Server提供服务注册服务，各个节点启动后，会在Eureka Server中进行注册，这样EurekaServer中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观的看到。</p>
<p>​    Eureka Client是一个java客户端，用于简化与Eureka Server的交互，客户端同时也就别一个内置的、使用轮询(round-robin)负载算法的负载均衡器。在应用启动后，将会向Eureka Server发送心跳,默认周期为30秒，如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，Eureka Server将会从服务注册表中把这个服务节点移除(默认90秒)。</p>
<p>​    Eureka Server之间通过复制的方式完成数据的同步，Eureka还提供了客户端缓存机制，即使所有的Eureka Server都挂掉，客户端依然可以利用缓存中的信息消费其他服务的API。综上，Eureka通过心跳检查、客户端缓存等机制，确保了系统的高可用性、灵活性和可伸缩性。</p>
<h2 id="2-2-Eureka服务端开发"><a href="#2-2-Eureka服务端开发" class="headerlink" title="2.2 Eureka服务端开发"></a>2.2 Eureka服务端开发</h2><p>（1）创建tensquare_eureka模块</p>
<p>（2）引入依赖  父工程pom.xml定义SpringCloud版本</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Finchley.M9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>tensquare_eureka模块pom.xml引入eureka-server</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）添加application.yml </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">6868</span> <span class="comment">#服务端口</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    regiter-with-eureka:</span> <span class="literal">false</span> <span class="comment">#是否将自己注册到Eureka服务中，本身就是所有无需注册</span></span><br><span class="line"><span class="attr">    fetch-registry:</span> <span class="literal">false</span>  <span class="comment">#是否从Eureka中获取注册信息</span></span><br><span class="line"><span class="attr">    service-url:</span>  <span class="comment">#Eureka客户端与Eureka服务端进行交互的地址</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://127.0.0.1:$&#123;server.port&#125;/eureka</span></span><br></pre></td></tr></table></figure>
<p>（3）编写启动类</p>
<p>创建包com.tensquare.eureka ，包下建立类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaServer.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）启动运行启动类，然后在浏览器地址栏输入  <a href="http://localhost:6868/" target="_blank" rel="noopener">http://localhost:6868/</a>  运行效果如下：</p>
<p> <img src="image/6-1.jpg" alt> </p>
<p>主界面中system status为系统信息  General Info为一般信息  Instances currently registered with Eureka为注册到的所有微服务列表</p>
<h2 id="2-3-服务注册"><a href="#2-3-服务注册" class="headerlink" title="2.3 服务注册"></a>2.3 服务注册</h2><p>我们现在就将所有的微服务都注册到Eureka中，这样所有的微服务之间都可以互相调用了。</p>
<p>（1）将其他微服务模块添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）修改每个微服务的application.yml，添加注册eureka服务的配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:6868/eureka</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>（3）修改每个服务类的启动类，添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaClient</span></span><br></pre></td></tr></table></figure>
<p>（4）启动测试：将每个微服务启动起来，会发现eureka的注册列表中可以看到这些微服务了 </p>
<p><img src="image/7_2.png" alt> </p>
<h2 id="2-4-保护模式"><a href="#2-4-保护模式" class="headerlink" title="2.4 保护模式"></a>2.4 保护模式</h2><p>如果在Eureka Server的首页看到以下这段提示，则说明Eureka已经进入了保护模式：</p>
<p><img src="image/7_1.png" alt></p>
<p>Eureka Server在运行期间，会统计心跳失败的比例在15分钟之内是否低于85%，如果出现低于的情况（在单机调试的时候很容易满足，实际在生产环境上通常是由于网络不稳定导致），Eureka Server会将当前的实例注册信息保护起来，同时提示这个警告。保护模式主要用于一组客户端和Eureka Server之间存在网络分区场景下的保护。一旦进入保护模式，Eureka Server将会尝试保护其服务注册表中的信息，不再删除服务注册表中的数据（也就是不会注销任何微服务）。</p>
<h1 id="3-Feign实现服务间的调用"><a href="#3-Feign实现服务间的调用" class="headerlink" title="3 Feign实现服务间的调用"></a>3 Feign实现服务间的调用</h1><h2 id="3-1-Feign简介"><a href="#3-1-Feign简介" class="headerlink" title="3.1 Feign简介"></a>3.1 Feign简介</h2><p>​    Feign是简化Java HTTP客户端开发的工具（java-to-httpclient-binder），它的灵感来自于<a href="https://github.com/square/retrofit" target="_blank" rel="noopener">Retrofit</a>、<a href="https://jax-rs-spec.java.net/nonav/2.0/apidocs/index.html" target="_blank" rel="noopener">JAXRS-2.0</a>和<a href="http://www.oracle.com/technetwork/articles/java/jsr356-1937161.html" target="_blank" rel="noopener">WebSocket</a>。Feign的初衷是降低统一绑定<a href="https://github.com/Netflix/Denominator" target="_blank" rel="noopener">Denominator</a>到HTTP API的复杂度，不区分是否为restful。</p>
<h2 id="3-2-快速体验"><a href="#3-2-快速体验" class="headerlink" title="3.2 快速体验"></a>3.2 快速体验</h2><p>我们现在在问答微服务（客户端）调用基础微服务（服务端）的方法（根据ID查询标签）</p>
<p>（1）在tensquare_qa模块添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）修改tensquare_qa模块的启动类，添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br></pre></td></tr></table></figure>
<p>（3）在tensquare_qa模块创建 com.tensquare.qa.client包，包下创建接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(<span class="string">"tensquare-base"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LabelClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/label/&#123;id&#125;"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">findById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@FeignClient注解用于指定从哪个服务中调用功能  ，<strong><em>注意</em></strong>  里面的名称与被调用的服务名保持一致，并且不能包含下划线。</p>
<p>@RequestMapping注解用于对被调用的微服务进行地址映射。<strong><em>注意</em></strong>   @PathVariable注解一定要指定参数名称，否则出错</p>
<p>（5）修改tensquare_qa模块的  ProblemController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> LabelClient labelClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/label/&#123;labelid&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findLabelById</span><span class="params">(@PathVariable  String labelid)</span></span>&#123;</span><br><span class="line">	Result result = labelClient.findById(labelid);</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（6）测试：<a href="http://localhost:9003/problem/label/1" target="_blank" rel="noopener">http://localhost:9003/problem/label/1</a>  能看到标签的信息</p>
<h2 id="3-3-负载均衡"><a href="#3-3-负载均衡" class="headerlink" title="3.3 负载均衡"></a>3.3 负载均衡</h2><p>测试：同时开启多个基础微服务，看是否是轮流调用。</p>
<p>修改tensquare_base工程LabelController的findById方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;id&#125;"</span>, method = RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findById</span><span class="params">(@PathVariable String id)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"No.1"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>,StatusCode.OK,<span class="string">"查询成功"</span>,labelService.findById(id)  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动基础微服务后，修改端口和输出信息，再次启动基础微服务</p>
<p>启动问答微服务，浏览器执行<a href="http://localhost:9003/problem/label/1" target="_blank" rel="noopener">http://localhost:9003/problem/label/1</a>   看是否轮流启动。</p>
<h1 id="4-交友微服务开发"><a href="#4-交友微服务开发" class="headerlink" title="4 交友微服务开发"></a>4 交友微服务开发</h1><h2 id="4-1-需求分析"><a href="#4-1-需求分析" class="headerlink" title="4.1 需求分析"></a>4.1 需求分析</h2><p>好友表：</p>
<table>
<thead>
<tr>
<th>好友表</th>
<th>tb_friend</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>字段名称</td>
<td>字段含义</td>
<td>字段类型</td>
<td>备注</td>
</tr>
<tr>
<td>userid</td>
<td>用户ID</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>friendid</td>
<td>好友ID</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>islike</td>
<td>是否互相喜欢</td>
<td>文本</td>
<td>0：单向喜欢  1：互相喜欢</td>
</tr>
</tbody>
</table>
<p>非好友表：</p>
<table>
<thead>
<tr>
<th>好友表</th>
<th>tb_nofriend</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>字段名称</td>
<td>字段含义</td>
<td>字段类型</td>
<td>备注</td>
</tr>
<tr>
<td>userid</td>
<td>用户ID</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>friendid</td>
<td>好友ID</td>
<td>文本</td>
</tr>
</tbody>
</table>
<p>交友微服务本身的功能:</p>
<p>（1）当用户登陆后在推荐好友列表中点击“心”，表示喜欢此人 ，在数据库tb_friend表中插入一条数据，islike 为0</p>
<p>（2）当你点击了喜欢过的人，也喜欢了你 , 表示互粉成功！也向tb_friend表中插入一条数据，islike为1 ，并且将你喜欢她的数据islike也修改为1 </p>
<p>（3）当你点击了不喜欢某人（点击了叉），向tb_nofriend添加记录.</p>
<p>（4）当两个人互粉后，其中一人不喜欢对方了，删除好友表中的记录 ，向非好友表中添加记录</p>
<p>什么场景下使用springCloud呢？</p>
<p>我们来看用户表，有两列：  fanscount 表示粉丝数  ，followcount表示关注数</p>
<p>（1）当用户点击了喜欢：</p>
<p>比如小宝关注了楚楚，小宝的followcount（关注数）加1  ， 楚楚的fanscount （粉丝数）加1</p>
<p>（2）当用户删除了好友：</p>
<p>比如楚楚删除了好友小宝，小宝的fanscount （粉丝数）减1 ，楚楚的followcount（关注数）减1</p>
<h2 id="4-2-交友微服务-添加与删除好友"><a href="#4-2-交友微服务-添加与删除好友" class="headerlink" title="4.2 交友微服务-添加与删除好友"></a>4.2 交友微服务-添加与删除好友</h2><h3 id="4-2-1-模块搭建"><a href="#4-2-1-模块搭建" class="headerlink" title="4.2.1 模块搭建"></a>4.2.1 模块搭建</h3><p>（1）创建工程tensquare_friend，pom.xml引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tensquare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tensquare_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）创建application.yml </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line"><span class="attr">  port:</span> <span class="number">9010</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line"><span class="attr">  application:</span>  </span><br><span class="line"><span class="attr">    name:</span> <span class="string">tensquare-friend</span> <span class="comment">#指定服务名</span></span><br><span class="line"><span class="attr">  datasource:</span>  </span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://192.168.184.134:3306/tensquare_friend?characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">  jpa:</span> </span><br><span class="line"><span class="attr">    database:</span> <span class="string">MySQL</span></span><br><span class="line"><span class="attr">    show-sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">jwt:</span></span><br><span class="line"><span class="attr"> config:</span></span><br><span class="line"><span class="attr">    key:</span> <span class="string">itcast</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:6868/eureka</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>（3）编写启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IdWorker <span class="title">idWorkker</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> IdWorker(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> JwtUtil <span class="title">jwtUtil</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> util.JwtUtil();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）创建JwtFilter（参见User工程）</p>
<p>（5）创建ApplicationConfig（参见User工程）</p>
<h3 id="4-2-2-添加好友"><a href="#4-2-2-添加好友" class="headerlink" title="4.2.2 添加好友"></a>4.2.2 添加好友</h3><p>（1）创建实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"tb_friend"</span>)</span><br><span class="line"><span class="meta">@IdClass</span>(Friend.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Friend</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String userid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String friendid;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserid</span><span class="params">(String userid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userid = userid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFriendid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> friendid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFriendid</span><span class="params">(String friendid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.friendid = friendid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）新建dao包，创建FriendDao接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 交友数据访问层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FriendDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Friend</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户ID与被关注用户ID查询记录个数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> friendid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"select count(f) from Friend f where f.userid=?1 and f.friendid=?2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">selectCount</span><span class="params">(String userid,String friendid)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新为互相喜欢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> friendid</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Modifying</span></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"update Friend f  set f.islike=?3 where f.userid=?1 and f.friendid=?2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateLike</span><span class="params">(String userid,String friendid,String islike)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）创建业务逻辑类</p>
<p>创建com.tensquare.friend.service包，包下建立类FriendService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FriendService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FriendDao friendDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addFriend</span><span class="params">(String userid,String friendid)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断如果用户已经添加了这个好友，则不进行任何操作,返回0</span></span><br><span class="line">        <span class="keyword">if</span>(friendDao.selectCount(userid, friendid)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//向喜欢表中添加记录</span></span><br><span class="line">        Friend friend=<span class="keyword">new</span> Friend();</span><br><span class="line">        friend.setUserid(userid);</span><br><span class="line">        friend.setFriendid(friendid);</span><br><span class="line">        friend.setIslike(<span class="string">"0"</span>);</span><br><span class="line">        friendDao.save(friend);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断对方是否喜欢你，如果喜欢，将islike设置为1</span></span><br><span class="line">        <span class="keyword">if</span>(friendDao.selectCount( friendid,userid)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            friendDao.updateLike(userid,friendid,<span class="string">"1"</span>);</span><br><span class="line">            friendDao.updateLike(friendid,userid,<span class="string">"1"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）控制器类</p>
<p>创建包com.tensquare.friend.controller，包下创建FriendController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/friend"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FriendController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FriendService friendService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  添加好友</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> friendid 对方用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type  1：喜欢 0：不喜欢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/like/&#123;friendid&#125;/&#123;type&#125;"</span>,method= RequestMethod.PUT)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">addFriend</span><span class="params">(@PathVariable String friendid , @PathVariable String type)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Claims claims=(Claims)request.getAttribute(<span class="string">"user_claims"</span>);</span><br><span class="line">        <span class="keyword">if</span>(claims==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.ACCESSERROR,<span class="string">"无权访问"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果是喜欢</span></span><br><span class="line">        <span class="keyword">if</span>(type.equals(<span class="string">"1"</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span>(friendService.addFriend(claims.getId(),friendid)==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.REPERROR,<span class="string">"已经添加此好友"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//不喜欢</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, StatusCode.OK, <span class="string">"操作成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）测试：</p>
<p>​    启动用户微服务，登陆用户获取token</p>
<p>​    启动交友微服务，通过postMan测试  <a href="http://localhost:9010/friend/like/1/1,添加头信息" target="_blank" rel="noopener">http://localhost:9010/friend/like/1/1,添加头信息</a>  Authorization  内容为Bearer  加上获取的token.</p>
<h3 id="4-2-3-添加非好友"><a href="#4-2-3-添加非好友" class="headerlink" title="4.2.3 添加非好友"></a>4.2.3 添加非好友</h3><p>需求：当用户点击不喜欢某人，将对方的ID记录不喜欢列表中</p>
<p>（1）构建实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"tb_nofriend"</span>)</span><br><span class="line"><span class="meta">@IdClass</span>(NoFriend.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoFriend</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String userid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String friendid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserid</span><span class="params">(String userid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userid = userid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFriendid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> friendid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFriendid</span><span class="params">(String friendid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.friendid = friendid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）创建数据访问接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不喜欢列表数据访问层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NoFriendDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">NoFriend</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）修改业务逻辑类FriendService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> NoFriendDao noFriendDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 向不喜欢列表中添加记录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> friendid</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNoFriend</span><span class="params">(String userid,String friendid)</span></span>&#123;</span><br><span class="line">    NoFriend noFriend=<span class="keyword">new</span> NoFriend();</span><br><span class="line">    noFriend.setUserid(userid);</span><br><span class="line">    noFriend.setFriendid(friendid);</span><br><span class="line">    noFriendDao.save(noFriend);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）修改FriendController的addFriend方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  添加好友</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> friendid 对方用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type  1：喜欢 0：不喜欢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/like/&#123;friendid&#125;/&#123;type&#125;"</span>,method= RequestMethod.PUT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">addFriend</span><span class="params">(@PathVariable String friendid , @PathVariable String type)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Claims claims=(Claims)request.getAttribute(<span class="string">"user_claims"</span>);</span><br><span class="line">    <span class="keyword">if</span>(claims==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.ACCESSERROR,<span class="string">"无权访问"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果是喜欢</span></span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"1"</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(friendService.addFriend(claims.getId(),friendid)==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.REPERROR,<span class="string">"已经添加此好友"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//不喜欢</span></span><br><span class="line">        friendService.addNoFriend(claims.getId(),friendid);<span class="comment">//向不喜欢列表中添加记录</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, StatusCode.OK, <span class="string">"操作成功"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-删除好友"><a href="#4-2-4-删除好友" class="headerlink" title="4.2.4 删除好友"></a>4.2.4 删除好友</h3><p>（1）FriendDao新增方法定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除喜欢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> friendid</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query</span>(<span class="string">"delete from Friend f where f.userid=?1 and f.friendid=?2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteFriend</span><span class="params">(String userid,String friendid)</span></span>;</span><br></pre></td></tr></table></figure>
<p>（2）FriendService新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 删除好友</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> friendid</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Transactional</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteFriend</span><span class="params">(String userid,String friendid)</span></span>&#123;</span><br><span class="line">     friendDao.deleteFriend(userid,friendid);</span><br><span class="line">     friendDao.updateLike(friendid,userid,<span class="string">"0"</span>);</span><br><span class="line">     addNoFriend(userid,friendid);<span class="comment">//向不喜欢表中添加记录</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>（3）FriendController新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除好友</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> friendid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;friendid&#125;"</span>,method=RequestMethod.DELETE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">remove</span><span class="params">(@PathVariable String friendid)</span></span>&#123;</span><br><span class="line">    Claims claims=(Claims)request.getAttribute(<span class="string">"user_claims"</span>);</span><br><span class="line">    <span class="keyword">if</span>(claims==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.ACCESSERROR,<span class="string">"无权访问"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    friendService.deleteFriend(claims.getId(), friendid);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, StatusCode.OK, <span class="string">"删除成功"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-3-用户微服务-粉丝数与关注数的变更"><a href="#4-3-用户微服务-粉丝数与关注数的变更" class="headerlink" title="4.3 用户微服务-粉丝数与关注数的变更"></a>4.3 用户微服务-粉丝数与关注数的变更</h2><h3 id="4-3-1-变更粉丝数"><a href="#4-3-1-变更粉丝数" class="headerlink" title="4.3.1 变更粉丝数"></a>4.3.1 变更粉丝数</h3><p>（1）修改tensquare_user工程的UserDao，增加方法定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新粉丝数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userid 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x 粉丝数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query</span>(<span class="string">"update User u set u.fanscount=u.fanscount+?2  where u.id=?1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incFanscount</span><span class="params">(String userid,<span class="keyword">int</span> x)</span></span>;</span><br></pre></td></tr></table></figure>
<p>（2）UserService增加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  更新粉丝数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">incFanscount</span><span class="params">(String userid,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	userDao.incFanscount(userid,x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）UserController增加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  增加粉丝数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/incfans/&#123;userid&#125;/&#123;x&#125;"</span>,method= RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incFanscount</span><span class="params">(@PathVariable String userid,@PathVariable <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	userService.incFanscount(userid,x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-3-2-变更关注数"><a href="#4-3-2-变更关注数" class="headerlink" title="4.3.2 变更关注数"></a>4.3.2 变更关注数</h3><p>（1）修改tensquare_user工程的UserDao，增加方法定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新关注数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userid 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x 粉丝数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query</span>(<span class="string">"update User u set u.followcount=u.followcount+?2  where u.id=?1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incFollowcount</span><span class="params">(String userid,<span class="keyword">int</span> x)</span></span>;</span><br></pre></td></tr></table></figure>
<p>（2）UserService增加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  更新关注数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">incFollowcount</span><span class="params">(String userid,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	userDao.incFollowcount(userid,x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）UserController增加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  增加关注数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/incfollow/&#123;userid&#125;/&#123;x&#125;"</span>,method= RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incFollowcount</span><span class="params">(@PathVariable String userid,@PathVariable <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	userService.incFollowcount(userid,x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-4-调用用户微服务"><a href="#4-4-调用用户微服务" class="headerlink" title="4.4 调用用户微服务"></a>4.4 调用用户微服务</h2><h3 id="4-4-1-喜欢某人更新用户数据"><a href="#4-4-1-喜欢某人更新用户数据" class="headerlink" title="4.4.1 喜欢某人更新用户数据"></a>4.4.1 喜欢某人更新用户数据</h3><p>（1）在tensquare_friend模块创建 com.tensquare.friend.client包，包下创建接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户客户端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient</span>(<span class="string">"tensquare-user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  增加粉丝数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/user/incfans/&#123;userid&#125;/&#123;x&#125;"</span>,method= RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incFanscount</span><span class="params">(@PathVariable(<span class="string">"userid"</span>)</span> String userid, @<span class="title">PathVariable</span><span class="params">(<span class="string">"x"</span>)</span> <span class="keyword">int</span> x)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  增加关注数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/user/incfollow/&#123;userid&#125;/&#123;x&#125;"</span>,method= RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incFollowcount</span><span class="params">(@PathVariable(<span class="string">"userid"</span>)</span> String userid,@<span class="title">PathVariable</span><span class="params">(<span class="string">"x"</span>)</span> <span class="keyword">int</span> x)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@FeignClient注解用于指定从哪个服务中调用功能  </p>
<p>@RequestMapping注解用于对被调用的微服务进行地址映射。</p>
<p><strong><em>注意</em></strong>   @PathVariable注解一定要指定参数名称，否则出错</p>
<p>（2）修改FriendService ，注入UserClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserClient userClient;</span><br></pre></td></tr></table></figure>
<p>​          修改addFriend方法,增加对userClient方法的调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userClient.incFollowcount(userid,<span class="number">1</span>);<span class="comment">//增加自己的关注数</span></span><br><span class="line">userClient.incFanscount(friendid,<span class="number">1</span>);<span class="comment">//增加对方的粉丝数</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-2-删除好友更新用户数据"><a href="#4-4-2-删除好友更新用户数据" class="headerlink" title="4.4.2 删除好友更新用户数据"></a>4.4.2 删除好友更新用户数据</h3><p>修改FriendService的deleteFriend方法 ,增加调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userClient.incFollowcount(userid,-<span class="number">1</span>);<span class="comment">//减少自己的关注数</span></span><br><span class="line">userClient.incFanscount(friendid,-<span class="number">1</span>);<span class="comment">//减少对方的粉丝数</span></span><br></pre></td></tr></table></figure>
<h1 id="面试问题"><a href="#面试问题" class="headerlink" title="面试问题"></a>面试问题</h1><h2 id="你在项目中使用SpringCloud的哪些组件"><a href="#你在项目中使用SpringCloud的哪些组件" class="headerlink" title="你在项目中使用SpringCloud的哪些组件?"></a>你在项目中使用SpringCloud的哪些组件?</h2><p>服务注册组件Eureka  服务发现组件Feign 熔断器   网关  SpringCloudConfig (集中配置管理) SpringCloudBus(消息总线)</p>
<h2 id="你在项目中哪个业务场景使用到微服务间的调用"><a href="#你在项目中哪个业务场景使用到微服务间的调用" class="headerlink" title="你在项目中哪个业务场景使用到微服务间的调用"></a>你在项目中哪个业务场景使用到微服务间的调用</h2><p>交友微服务  添加好友，在交友微服务中调用用户微服务的更改粉丝数与关注数的方法。</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2019/04/20/my-work0 (7)/"></a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Single Dog</a></p>
        <p><span>发布时间:</span>2019-04-20, 22:58:54</p>
        <p><span>最后更新:</span>2019-03-08, 21:12:36</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2019/04/20/my-work0 (7)/" title>http://yoursite.com/2019/04/20/my-work0 (7)/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2019/04/20/my-work0 (7)/　　作者: Single Dog" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2019/04/20/my-work0 (8)/">
                    
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2019/04/20/my-work0 (6)/">
                    
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#第7章-SpringCloud之初入江湖"><span class="toc-number">1.</span> <span class="toc-text">第7章-SpringCloud之初入江湖</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-SpringCloud简介"><span class="toc-number">2.</span> <span class="toc-text">1 SpringCloud简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-什么是SpringCloud"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 什么是SpringCloud</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-SpringCloud与SpringBoot的关系"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 SpringCloud与SpringBoot的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-SpringCloud主要框架"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 SpringCloud主要框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Spring-Cloud和Dubbo对比"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 Spring Cloud和Dubbo对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-说说SpringCloud的版本"><span class="toc-number">2.5.</span> <span class="toc-text">1.5 说说SpringCloud的版本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-服务发现组件-Eureka"><span class="toc-number">3.</span> <span class="toc-text">2 服务发现组件 Eureka</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Eureka"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 Eureka</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Eureka服务端开发"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 Eureka服务端开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-服务注册"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 服务注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-保护模式"><span class="toc-number">3.4.</span> <span class="toc-text">2.4 保护模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Feign实现服务间的调用"><span class="toc-number">4.</span> <span class="toc-text">3 Feign实现服务间的调用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Feign简介"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 Feign简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-快速体验"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 快速体验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-负载均衡"><span class="toc-number">4.3.</span> <span class="toc-text">3.3 负载均衡</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-交友微服务开发"><span class="toc-number">5.</span> <span class="toc-text">4 交友微服务开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-需求分析"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 需求分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-交友微服务-添加与删除好友"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 交友微服务-添加与删除好友</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-模块搭建"><span class="toc-number">5.2.1.</span> <span class="toc-text">4.2.1 模块搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-添加好友"><span class="toc-number">5.2.2.</span> <span class="toc-text">4.2.2 添加好友</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-添加非好友"><span class="toc-number">5.2.3.</span> <span class="toc-text">4.2.3 添加非好友</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-删除好友"><span class="toc-number">5.2.4.</span> <span class="toc-text">4.2.4 删除好友</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-用户微服务-粉丝数与关注数的变更"><span class="toc-number">5.3.</span> <span class="toc-text">4.3 用户微服务-粉丝数与关注数的变更</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-变更粉丝数"><span class="toc-number">5.3.1.</span> <span class="toc-text">4.3.1 变更粉丝数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-变更关注数"><span class="toc-number">5.3.2.</span> <span class="toc-text">4.3.2 变更关注数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-调用用户微服务"><span class="toc-number">5.4.</span> <span class="toc-text">4.4 调用用户微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-喜欢某人更新用户数据"><span class="toc-number">5.4.1.</span> <span class="toc-text">4.4.1 喜欢某人更新用户数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2-删除好友更新用户数据"><span class="toc-number">5.4.2.</span> <span class="toc-text">4.4.2 删除好友更新用户数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#面试问题"><span class="toc-number">6.</span> <span class="toc-text">面试问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#你在项目中使用SpringCloud的哪些组件"><span class="toc-number">6.1.</span> <span class="toc-text">你在项目中使用SpringCloud的哪些组件?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#你在项目中哪个业务场景使用到微服务间的调用"><span class="toc-number">6.2.</span> <span class="toc-text">你在项目中哪个业务场景使用到微服务间的调用</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"　| Hexo　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2019/04/20/my-work0 (8)/" title="上一篇: ">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2019/04/20/my-work0 (6)/" title="下一篇: ">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (10)/">my-work0 (10)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (9)/">my-work0 (9)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (8)/">my-work0 (8)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (7)/">my-work0 (7)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (6)/">my-work0 (6)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (5)/">my-work0 (5)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/my-work0 (4)/">my-work0 (4)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/hello-b/">hello-b</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/hello-a/">hello-a</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2019 Single Dog
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>